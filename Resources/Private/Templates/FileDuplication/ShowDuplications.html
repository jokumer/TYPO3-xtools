<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	xmlns:fl="http://typo3.org/ns/TYPO3/CMS/Filelist/ViewHelpers">
<f:layout name="Default"/>

<f:section name="content">
	<f:flashMessages/>
	<f:link.action
			controller="FileDuplication"
			action="index"
			arguments="{selection:{storage:data.selection.storage.uid, directory:data.selection.directory}}"
			class="btn btn-sm btn-info">
		Back to index
	</f:link.action>
	<h2>
		<f:translate key="controller.fileDuplication.action.index"/>
	</h2>
	<h3>File and duplicates</h3>
	<f:if condition="{fileDuplications}">
		<f:then>
			<p>
				Files sha1: {fileDuplications.0.fileFacade.sha1}<br/>
				Files count: <f:count subject="{fileDuplications}"/><br/>
				<f:if condition="{data.selection.storage}">
					Storage [uid]: {data.selection.storage.name} [{data.selection.storage.uid}]<br/>
				</f:if>
				<f:if condition="{data.selection.directory}">
					Directory: {data.selection.directory}<br/>
				</f:if>
			</p>
			<f:if condition="{f:count(subject:'{fileDuplications}')} > {extensionConfiguration.pagination_itemsPerPage}">
				<f:then>
					<f:widget.paginate objects="{fileDuplications}" as="results" configuration="{itemsPerPage: '{extensionConfiguration.pagination_itemsPerPage}', insertAbove: 1 insertBelow: 1}">
						<f:render section="list" arguments="{results:results, data:data}"/>
					</f:widget.paginate>
				</f:then>
				<f:else>
					<f:render section="list" arguments="{results:fileDuplications, data:data}"/>
				</f:else>
			</f:if>
		</f:then>
		<f:else>
			No files found!
		</f:else>
	</f:if>
</f:section>

<f:section name="list">
	<f:form action="solveDuplications" controller="FileDuplication">
		<f:form.hidden name="selection[storage]" value="{data.selection.storage.uid}"/>
		<f:form.hidden name="selection[directory]" value="{data.selection.directory}"/>
		<table class="t3-table t3-datatable">
			<theader>
				<tr>
					<th><span title="Preferred file for replacement(s)">&#10004;</span></th>
					<th>Uid</th>
					<th>Preview</th>
					<th>Filename</th>
					<th>Meta</th>
					<th>Date File (created, modify)</th>
					<th>Date DB (created, modify)</th>
					<th>Usage</th>
				</tr>
			</theader>
			<tbody>
			<f:for each="{results}" as="fileDuplication" iteration="iterator">
				<tr class="{f:if(condition: iterator.isEven, then: 'even', else: 'odd')}"
					role="row">
					<td>
						<f:if condition="{iterator.isFirst}">
							<f:form.hidden name="sha1" value="{fileDuplication.fileFacade.sha1}"/>
						</f:if>
						<f:form.radio id="preferred-file-selection-{fileDuplication.fileFacade.uid}" name="preferredFileUid" value="{fileDuplication.fileFacade.uid}"/>
					</td>
					<td style="white-space: nowrap">
						<fl:link.clickMenuOnIcon table="{fileDuplication.fileFacade.combinedIdentifier}">
							{fileDuplication.fileFacade.icon->f:format.raw()} {fileDuplication.fileFacade.uid}
						</fl:link.clickMenuOnIcon>
					</td>
					<td>
						<f:if condition="{fileDuplication.fileFacade.publicUrl}">
							<f:then>
								<a href="{fileDuplication.fileFacade.publicUrl}" target="_blank" title="{fileDuplication.fileFacade.publicUrl}">
									<f:if condition="{fileDuplication.fileFacade.type} == 2">
										<f:image
												image="{fileDuplication.fileFacade.resource}"
												alt="{fileDuplication.fileFacade.name}"
												treatIdAsReference="0"
												maxWidth="64"
												maxHeight="64"
												style="max-height:64px; max-width:64px;"/>
									</f:if>
								</a>
							</f:then>
							<f:else>
								<span title="{fileDuplication.fileFacade.publicUrl}">
									NOT FOUND
								</span>
							</f:else>
						</f:if>
					</td>
					<td>
						<f:if condition="{fileDuplication.fileFacade.publicUrl}">
							<f:then>
								<a href="{fileDuplication.fileFacade.publicUrl}" target="_blank" title="{fileDuplication.fileFacade.publicUrl}">
									{fileDuplication.fileFacade.name}
								</a>
							</f:then>
							<f:else>
								<span title="{fileDuplication.fileFacade.publicUrl}">{fileDuplication.fileFacade.name} NOT FOUND</span>
							</f:else>
						</f:if>
					</td>
					<td>
						<b>Title</b>:&nbsp;{fileDuplication.fileFacade.properties.title}<br/>
						<b>Description</b>:&nbsp;{fileDuplication.fileFacade.properties.description}<br/>
						<b>Keywords</b>:&nbsp;{fileDuplication.fileFacade.properties.keywords}<br/>
						<b>Caption</b>:&nbsp;{fileDuplication.fileFacade.properties.caption}<br/>
					</td>
					<td>
						<f:format.date format="Y.m.d. H:i">{fileDuplication.fileFacade.properties.creation_date}</f:format.date><br/>
						<f:format.date format="Y.m.d. H:i">{fileDuplication.fileFacade.properties.modification_date}</f:format.date><br/>
					</td>
					<td>
						<f:format.date format="Y.m.d. H:i">{fileDuplication.fileFacade.properties.crdate}</f:format.date><br/>
						<f:format.date format="Y.m.d. H:i">{fileDuplication.fileFacade.properties.tstamp}</f:format.date><br/>
					</td>
					<td>
						{fileDuplication.usage}
					</td>
				</tr>
			</f:for>
			</tbody>
		</table>
		<f:form.submit value="Replace" class="btn btn-danger"/>
	</f:form>
</f:section>