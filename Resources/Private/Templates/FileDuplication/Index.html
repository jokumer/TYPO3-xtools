<f:layout name="Default"/>

<f:section name="content">
	<f:flashMessages/>
	<h2>
		<f:translate key="controller.fileDuplication.action.index"/>
	</h2>
	<h3>Storages</h3>
	<f:if condition="{data.list.storages}">
		<f:then>
			<f:render partial="Toolbox/FileDuplication/StorageList" arguments="{_all}"/>
		</f:then>
		<f:else>
			No storages found!
		</f:else>
	</f:if>
	<h3>Files and duplications</h3>
	<f:if condition="{filesDuplications}">
		<f:then>
			<p>
				Files count: <f:count subject="{filesDuplications}"/>
			</p>
			<f:if condition="{f:count(subject:'{filesDuplications}')} > {extensionConfiguration.pagination_itemsPerPage}">
				<f:then>
					<f:widget.paginate objects="{filesDuplications}"
									   as="results"
									   configuration="{
									     itemsPerPage: '{extensionConfiguration.pagination_itemsPerPage}',
									     insertAbove: 1,
									     insertBelow: 1
									   }">
						<f:render section="list" arguments="{results:results, data:data}"/>
					</f:widget.paginate>
				</f:then>
				<f:else>
					<f:render section="list" arguments="{results:filesDuplications, data:data}"/>
				</f:else>
			</f:if>
		</f:then>
		<f:else>
			No duplications found!
			<f:if condition="{data.selection.storage}">
				<f:then></f:then>
				<f:else>
					Please select a storage.
				</f:else>
			</f:if>
		</f:else>
	</f:if>
</f:section>

<f:section name="list">
	<table class="t3-table t3-datatable">
		<theader>
			<tr>
				<th>Count</th>
				<th>Preview</th>
				<th>File (first found)</th>
				<th>Type</th>
				<th>Sha1</th>
			</tr>
		</theader>
		<tbody>
		<f:for each="{results}" as="filesDuplication" iteration="iterator">
			<tr class="{f:if(condition: iterator.isEven, then: 'even', else: 'odd')}"
				role="row">
				<td>
					<strong>{filesDuplication.totalCount}</strong>
				</td>
				<td>
					<f:if condition="{filesDuplication.uid}">
						<f:then>
							<a href="{f:uri.image(src:filesDuplication.uid, treatIdAsReference:0)}"
							   target="_blank"
							   title="{f:uri.image(src:filesDuplication.uid, treatIdAsReference:0)}">
								<f:if condition="{filesDuplication.type} == 2">
									<f:image
											src="{filesDuplication.uid}"
											alt="{filesDuplication.name}"
											treatIdAsReference="0"
											maxWidth="64"
											maxHeight="64"
											style="max-height:64px; max-width:64px;"/>
								</f:if>
							</a>
						</f:then>
						<f:else>
							<span title="{filesDuplication.publicUrl}">NOT FOUND</span>
						</f:else>
					</f:if>
				</td>
				<td>
					<f:link.action action="showDuplications"
								   controller="FileDuplication"
								   arguments="{
								     selection:{storage:data.selection.storage.uid, directory:data.selection.directory},
								     sha1:filesDuplication.sha1
								   }">
						{filesDuplication.name}
					</f:link.action>
				</td>
				<td>
					{filesDuplication.type}
				</td>
				<td>
					<em>{filesDuplication.sha1}</em>
				</td>
			</tr>
		</f:for>
		</tbody>
	</table>
</f:section>